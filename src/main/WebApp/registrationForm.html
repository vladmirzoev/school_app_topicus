<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles/bootstrap.css">
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="styles/styleExtras.css">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Registration</title>

    <script>
        //TODO put javascript for getting specific school form here

        function render() {
            var methodcall = './api/school/getschools/';
            var req = new XMLHttpRequest();
            req.open('GET', methodcall, true);
            req.onreadystatechange = function () {
                if (req.readyState === XMLHttpRequest.DONE) {
                    if (req.status === 200) {
                        let obj = JSON.parse(req.responseText);
                        for (let i = 0; i < obj.length; i++) {
                            let x = document.getElementById("dropdown")
                            let y = document.createElement("option")
                            y.innerText = obj[i].school_name;
                            y.value = obj[i].school_name;
                            x.append(y)
                        }
                    }
                }
            };
            req.send();
        }
    </script>
</head>
<body style="background-color: #EAEDF0;" onload="render()">
<div class="blackbox mx-auto">
    <div class="container text-center">
        <h1 class="mainHeader">Child Details</h1>
    </div>
    <div>
        <div class="formText3">Child name</div>
        <input class="inputs" type="text" placeholder="Name and Surname" style="width: 600px;" id="childname"
               required onkeyup="enableSubmit()">
        <div class="formText3">Child Date of Birth</div>
        <input class="inputs" type="date" style="width: 600px;" id="birthdate" required onkeyup="enableSubmit()">
        <div class="formText3">Guardian name</div>
        <input class="inputs" type="text" placeholder="Name and Surname" style="width: 600px;" id="guardianname"
               required onkeyup="enableSubmit()">
    </div>
    <div class="row" style="margin: 0px">
        <div class="col-6 formText3" style="padding: 0px">
            Telephone
        </div>
        <div class="col-6 formText3" style="padding-left: 15px">
            Telephone 2 (optional)
        </div>

        <div class="col-6" style="padding: 0px">
            <input class="inputs" type="text" style="width: 280px" id="telephone1" required
                   onkeyup="enableSubmit()">
        </div>
        <div class="col-6" style="padding: 0px">
            <input class="inputs" type="text" style="width: 285px;margin-left: 15px;" id="telephone2" required
                   onkeyup="enableSubmit()">
        </div>
    </div>
    <div class="formText3">Guardian contact e-mail</div>
    <input class="inputs" type="email" style="width: 600px;" id="email" required onkeyup="enableSubmit()">
    <div class="formText3">Address</div>
    <input class="inputs" type="text" style="width: 600px;" id="address" required onkeyup="enableSubmit()">
    <div class="formText3">Child's BSN number:</div>
    <input class="inputs" type="text" style="width: 600px;" id="bsn" required onkeyup="enableSubmit()">
    <div class="formText3">Grade of study</div>
    <input class="inputs" type="text" style="width: 600px;" id="grade" required onkeyup="enableSubmit()">
    <div class="formText3">School:</div>
    <select class="inputs" type="text" style="width: 600px" id="dropdown"></select>
    <div class="row justify-content-center align-items-center">
        <div class="col-6" style="margin-top: 10px">
            <input type="button" value="Confirm" class="btn btn-primary" onclick="check()">
        </div>
    </div>

    <script>
        function check() {
            let valid = true;

            let childname = document.getElementById("childname").value;
            let guardianname = document.getElementById("guardianname").value;
            let telephone1 = document.getElementById("telephone1").value;
            let telephone2 = document.getElementById("telephone2").value;
            let email = document.getElementById("email").value;
            let bsn = document.getElementById("bsn").value;
            let birthdate = document.getElementById("birthdate").value;
            let address = document.getElementById("address").value;
            let grade = document.getElementById("grade").value;
            let schoolname = document.getElementById("dropdown").value;

            //TODO elaborate on input validation

            if (!childname) {
                document.getElementById("childname").style.borderColor = "#FF0000";
                document.getElementById("childname").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (!guardianname) {
                document.getElementById("guardianname").style.borderColor = "#FF0000";
                document.getElementById("guardianname").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (!telephone1) {
                document.getElementById("telephone1").style.borderColor = "#FF0000";
                document.getElementById("telephone1").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (!telephone2) {
                document.getElementById("telephone2").style.borderColor = "#FF0000";
                document.getElementById("telephone2").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (!email) {
                document.getElementById("email").style.borderColor = "#FF0000";
                document.getElementById("email").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (!bsn) {
                document.getElementById("bsn").style.borderColor = "#FF0000";
                document.getElementById("bsn").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (!address) {
                document.getElementById("address").style.borderColor = "#FF0000";
                document.getElementById("address").style.backgroundColor = "#FFBFBF";
                valid = false;

            }

            if (!grade) {
                document.getElementById("grade").style.borderColor = "#FF0000";
                document.getElementById("grade").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (!birthdate) {
                document.getElementById("birthdate").style.borderColor = "#FF0000";
                document.getElementById("birthdate").style.backgroundColor = "#FFBFBF";
                valid = false;
            }

            if (valid) {
                submitform(childname, guardianname, telephone1, telephone2, email, bsn, birthdate, address, grade, schoolname);
            }
        }

        function submitform(childname, guardianname, telephone1, telephone2, email, bsn, birthdate, address, grade, schoolname) {

            //TODO this is a security issue if people inspect this script
            let methodcall = '.api/form/uploadBasicReq/' + childname + '/' + guardianname + '/' + telephone1 + '/' + telephone2 + '/' + email + '/' + bsn + '/' + birthdate + '/' + address + '/' + grade + '/' + schoolname;
            console.log(methodcall)
            xhr = new XMLHttpRequest();
            xhr.open('POST', methodcall, true);
            xhr.send()

            openPopup2();
        }
    </script>

    <div class="popup2" id="popup2">
        <h2>Thank you!</h2>
        <p style="color: #000000">The registration is successfully completed!</p><br>
        <p style="color: #000000">You may now proceed to the school form!</p><br>
        <a href="login.html">
            <input type="button" class="btn btn-primary" style="font-size: 16px" onclick="redirect()" value="Continue">
            <script>
                function redirect(){
                    //TODO redirect to school form
                    window.location.href = "login.html";
                }
            </script>
        </a>
    </div>
</div>
<script src="scripts/popup.js"></script>
</body>
</html>